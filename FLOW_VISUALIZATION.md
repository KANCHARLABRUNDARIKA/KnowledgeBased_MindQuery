# RAG System - User Flow Visualization

## Complete System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAG SYSTEM USER FLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. USER       â”‚
â”‚   UPLOADS       â”‚
â”‚   DOCUMENT      â”‚
â”‚                 â”‚
â”‚  ğŸ“„ PDF         â”‚
â”‚  ğŸ“„ DOCX        â”‚
â”‚  ğŸ“„ TXT         â”‚
â”‚  ğŸ“„ MD          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   2. DOCUMENT PROCESSOR             â”‚
â”‚                                     â”‚
â”‚   âœ“ Read file content               â”‚
â”‚   âœ“ Extract text based on type:    â”‚
â”‚     â€¢ PDF    â†’ PyPDF2               â”‚
â”‚     â€¢ DOCX   â†’ python-docx          â”‚
â”‚     â€¢ TXT/MD â†’ Direct read          â”‚
â”‚   âœ“ Validate content exists         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   3. TEXT CHUNKING                  â”‚
â”‚                                     â”‚
â”‚   RecursiveCharacterTextSplitter    â”‚
â”‚   â€¢ Chunk Size: 1000 chars          â”‚
â”‚   â€¢ Overlap: 200 chars              â”‚
â”‚   â€¢ Separators: \n\n, \n, space     â”‚
â”‚                                     â”‚
â”‚   Metadata per chunk:               â”‚
â”‚   â€¢ source: filename                â”‚
â”‚   â€¢ chunk_id: sequential number     â”‚
â”‚   â€¢ document_type: uploaded_doc     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   4. EMBEDDING GENERATION           â”‚
â”‚                                     â”‚
â”‚   HuggingFace Embeddings            â”‚
â”‚   â€¢ Model: sentence-transformers    â”‚
â”‚   â€¢ Converts text â†’ vectors         â”‚
â”‚   â€¢ Captures semantic meaning       â”‚
â”‚   â€¢ Same model for docs & queries   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   5. VECTOR STORAGE                 â”‚
â”‚                                     â”‚
â”‚   ChromaDB                          â”‚
â”‚   Path: data/user_vectorstores/     â”‚
â”‚         {user_id}/                  â”‚
â”‚                                     â”‚
â”‚   âœ“ Persistent storage              â”‚
â”‚   âœ“ Isolated per user               â”‚
â”‚   âœ“ Fast similarity search          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DOCUMENT      â”‚
â”‚   READY FOR     â”‚
â”‚   QUERYING!     â”‚
â”‚   âœ… Stored     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    QUERY PROCESSING FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USER ASKS     â”‚
â”‚   QUESTION      â”‚
â”‚                 â”‚
â”‚   "What is X?"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   6. QUERY EXPANSION                â”‚
â”‚                                     â”‚
â”‚   Paraphraser (Question Generator)  â”‚
â”‚   â€¢ Original: "What is X?"          â”‚
â”‚   â€¢ Paraphrase 1: "Explain X"       â”‚
â”‚   â€¢ Paraphrase 2: "Describe X"      â”‚
â”‚   â€¢ Paraphrase 3: "Define X"        â”‚
â”‚                                     â”‚
â”‚   Purpose: Improve retrieval recall â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   7. EMBEDDING & SEARCH             â”‚
â”‚                                     â”‚
â”‚   For each query variant:           â”‚
â”‚   1. Generate query embedding       â”‚
â”‚   2. Search vector database         â”‚
â”‚   3. Find most similar chunks       â”‚
â”‚   4. Calculate cosine similarity    â”‚
â”‚                                     â”‚
â”‚   Returns: Top K relevant chunks    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   8. CONTEXT PREPARATION            â”‚
â”‚                                     â”‚
â”‚   Combine retrieved chunks:         â”‚
â”‚   â€¢ Remove duplicates               â”‚
â”‚   â€¢ Rank by relevance               â”‚
â”‚   â€¢ Format for LLM                  â”‚
â”‚                                     â”‚
â”‚   Context Template:                 â”‚
â”‚   "Context from documents:          â”‚
â”‚    [chunk 1]                        â”‚
â”‚    [chunk 2]                        â”‚
â”‚    ...                              â”‚
â”‚    Question: {user_question}"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   9. LLM PROCESSING (GEMINI)        â”‚
â”‚                                     â”‚
â”‚   Google Gemini AI                  â”‚
â”‚   â€¢ Receives: Context + Question    â”‚
â”‚   â€¢ Instructions: Answer ONLY       â”‚
â”‚     based on provided context       â”‚
â”‚   â€¢ No external knowledge           â”‚
â”‚   â€¢ Format with markdown            â”‚
â”‚                                     â”‚
â”‚   If context insufficient:          â”‚
â”‚   â†’ "I don't have enough info..."   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   10. RESPONSE GENERATION           â”‚
â”‚                                     â”‚
â”‚   Gemini generates:                 â”‚
â”‚   â€¢ Comprehensive answer            â”‚
â”‚   â€¢ Well-formatted (markdown)       â”‚
â”‚   â€¢ Context-grounded                â”‚
â”‚   â€¢ Relevant to query               â”‚
â”‚                                     â”‚
â”‚   Additional info returned:         â”‚
â”‚   â€¢ Expanded queries used           â”‚
â”‚   â€¢ Retrieved document chunks       â”‚
â”‚   â€¢ Knowledge base type             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   11. RETURN    â”‚
â”‚   TO USER       â”‚
â”‚                 â”‚
â”‚   âœ… Answer     â”‚
â”‚   ğŸ“ Sources    â”‚
â”‚   ğŸ” Queries    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER LAYER                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Web Browser        â”‚       API Clients                     â”‚
â”‚   (Gradio GUI)       â”‚       (curl, Python, etc.)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                             â”‚
           â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASTAPI BACKEND                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Routers                                         â”‚  â”‚
â”‚  â”‚  â€¢ document_router.py  (Upload, List, Delete)        â”‚  â”‚
â”‚  â”‚  â€¢ qa_service.py       (Question Answering)          â”‚  â”‚
â”‚  â”‚  â€¢ query_service.py    (Query Expansion)             â”‚  â”‚
â”‚  â”‚  â€¢ question_service.py (Hypothetical Questions)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                            â”‚
              â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOCUMENT PROCESSOR      â”‚   â”‚  RAG MODEL               â”‚
â”‚                          â”‚   â”‚                          â”‚
â”‚  â€¢ PDF extraction        â”‚   â”‚  â€¢ Query expansion       â”‚
â”‚  â€¢ DOCX parsing          â”‚   â”‚  â€¢ Vector search         â”‚
â”‚  â€¢ TXT/MD reading        â”‚   â”‚  â€¢ Context preparation   â”‚
â”‚  â€¢ Text chunking         â”‚   â”‚  â€¢ LLM invocation        â”‚
â”‚  â€¢ Metadata management   â”‚   â”‚  â€¢ Response formatting   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                           â”‚
             â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EMBEDDING SERVICE       â”‚   â”‚  LLM SERVICE             â”‚
â”‚                          â”‚   â”‚                          â”‚
â”‚  HuggingFace             â”‚   â”‚  Google Gemini API       â”‚
â”‚  â€¢ sentence-transformers â”‚   â”‚  â€¢ gemini-pro            â”‚
â”‚  â€¢ 384-dim vectors       â”‚   â”‚  â€¢ Temperature: 0.7      â”‚
â”‚  â€¢ Cached model          â”‚   â”‚  â€¢ Max tokens: 2048      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VECTOR DATABASE (ChromaDB)                               â”‚
â”‚                                                           â”‚
â”‚  data/user_vectorstores/                                  â”‚
â”‚  â”œâ”€â”€ user-1/                                              â”‚
â”‚  â”‚   â”œâ”€â”€ chroma.sqlite3                                   â”‚
â”‚  â”‚   â””â”€â”€ {collection_id}/                                â”‚
â”‚  â”‚       â””â”€â”€ [vector embeddings]                         â”‚
â”‚  â”œâ”€â”€ user-2/                                              â”‚
â”‚  â”‚   â””â”€â”€ ...                                             â”‚
â”‚  â””â”€â”€ user-N/                                              â”‚
â”‚                                                           â”‚
â”‚  Features:                                                â”‚
â”‚  â€¢ Persistent storage                                     â”‚
â”‚  â€¢ Fast similarity search (cosine distance)               â”‚
â”‚  â€¢ Metadata filtering                                     â”‚
â”‚  â€¢ User isolation                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow for Document Upload

```
FILE (user's computer)
    |
    | HTTP POST multipart/form-data
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI Endpoint    â”‚
â”‚ /documents/upload   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           | UploadFile object
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DocumentProcessor   â”‚
â”‚ .process_and_store  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€> save_upload_file()
           â”‚    (temp storage)
           â”‚
           â”œâ”€â”€> extract_text_from_file()
           â”‚    â€¢ PDF â†’ PyPDF2.PdfReader
           â”‚    â€¢ DOCX â†’ python-docx.Document
           â”‚    â€¢ TXT/MD â†’ file.read()
           â”‚
           â”œâ”€â”€> create_documents_from_text()
           â”‚    â€¢ RecursiveCharacterTextSplitter
           â”‚    â€¢ Add metadata (source, chunk_id)
           â”‚
           â”œâ”€â”€> get_embeddings()
           â”‚    â€¢ HuggingFaceEmbeddings
           â”‚    â€¢ Load cached model
           â”‚
           â”œâ”€â”€> Load or Create Chroma vectorstore
           â”‚    â€¢ persist_directory: user_vectorstores/{user_id}
           â”‚
           â”œâ”€â”€> vectorstore.add_documents()
           â”‚    â€¢ Generate embeddings for chunks
           â”‚    â€¢ Store in ChromaDB
           â”‚
           â””â”€â”€> vectorstore.persist()
                (save to disk)

Response JSON:
{
  "status": "success",
  "document_name": "example.pdf",
  "chunks_created": 42,
  "user_id": "abc-123",
  "vectorstore_path": "data/user_vectorstores/abc-123"
}
```

---

## Data Flow for Question Answering

```
QUESTION (user input)
    |
    | HTTP POST application/json
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI Endpoint    â”‚
â”‚ /generate-answer    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           | ChatRequest (messages list)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ get_user_rag_model  â”‚
â”‚ (or combined)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           | Load user's vectorstore
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QuestionAnsweringWith       â”‚
â”‚ QueryExpansion              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€> 1. PARAPHRASER.generate_paraphrases()
           â”‚    Input: "How do I install?"
           â”‚    Output: [
           â”‚      "How do I install?",
           â”‚      "What are installation steps?",
           â”‚      "How to set this up?"
           â”‚    ]
           â”‚
           â”œâ”€â”€> 2. For each paraphrase:
           â”‚    â”‚
           â”‚    â”œâ”€â”€> Embed query
           â”‚    â”‚    (HuggingFace embeddings)
           â”‚    â”‚
           â”‚    â””â”€â”€> vectorstore.similarity_search()
           â”‚         (ChromaDB cosine similarity)
           â”‚         Returns: Top 3-5 chunks per query
           â”‚
           â”œâ”€â”€> 3. Combine & deduplicate chunks
           â”‚    Remove duplicates across queries
           â”‚    Rank by similarity score
           â”‚
           â”œâ”€â”€> 4. Format prompt
           â”‚    Template:
           â”‚    "You are an intelligent assistant...
           â”‚     Context: {retrieved_chunks}
           â”‚     Question: {original_question}"
           â”‚
           â””â”€â”€> 5. LLM.invoke(prompt)
                â”‚
                | Google Gemini API call
                â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Gemini Pro    â”‚
           â”‚  â€¢ Reads ctx   â”‚
           â”‚  â€¢ Generates   â”‚
           â”‚  â€¢ Formats MD  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    | AI-generated answer
                    â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Format Responseâ”‚
           â”‚ â€¢ messages[]   â”‚
           â”‚ â€¢ questions[]  â”‚
           â”‚ â€¢ documents[]  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼

Response JSON:
{
  "messages": [
    {"role": "user", "content": "How do I install?"},
    {"role": "system", "content": "Based on the docs..."}
  ],
  "questions": ["How do I install?", "What are steps?"],
  "documents": ["Chunk 1 text...", "Chunk 2 text..."],
  "user_id": "abc-123",
  "knowledge_base_type": "personal"
}
```

---

## Technology Stack Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND                           â”‚
â”‚  Gradio UI (Python-based web interface)              â”‚
â”‚  â€¢ File upload widget                                 â”‚
â”‚  â€¢ Chat interface                                     â”‚
â”‚  â€¢ Document management                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP Requests
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND                            â”‚
â”‚  FastAPI (Python async web framework)                â”‚
â”‚  â€¢ RESTful API endpoints                              â”‚
â”‚  â€¢ Request validation (Pydantic)                      â”‚
â”‚  â€¢ CORS middleware                                    â”‚
â”‚  â€¢ Auto-generated docs (/docs)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚
        â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LangChain   â”‚   â”‚  Document        â”‚
â”‚   Framework   â”‚   â”‚  Processing      â”‚
â”‚               â”‚   â”‚                  â”‚
â”‚  â€¢ RAG setup  â”‚   â”‚  â€¢ PyPDF2        â”‚
â”‚  â€¢ Prompts    â”‚   â”‚  â€¢ python-docx   â”‚
â”‚  â€¢ Chains     â”‚   â”‚  â€¢ Text split    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        HuggingFace Ecosystem          â”‚
â”‚  â€¢ Transformers library               â”‚
â”‚  â€¢ sentence-transformers              â”‚
â”‚  â€¢ Embedding models                   â”‚
â”‚  â€¢ Model caching                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ChromaDB                     â”‚
â”‚  â€¢ Vector storage                     â”‚
â”‚  â€¢ Similarity search                  â”‚
â”‚  â€¢ SQLite backend                     â”‚
â”‚  â€¢ Metadata filtering                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Google Gemini API                â”‚
â”‚  â€¢ Cloud-based LLM                    â”‚
â”‚  â€¢ REST API calls                     â”‚
â”‚  â€¢ Streaming responses                â”‚
â”‚  â€¢ Context-aware generation           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Types Support Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Format  â”‚ Extension   â”‚ Extraction   â”‚ Use Cases         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PDF     â”‚ .pdf        â”‚ PyPDF2       â”‚ â€¢ Research papers â”‚
â”‚         â”‚             â”‚ PdfReader    â”‚ â€¢ Reports         â”‚
â”‚         â”‚             â”‚              â”‚ â€¢ eBooks          â”‚
â”‚         â”‚             â”‚              â”‚ â€¢ Manuals         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Word    â”‚ .docx       â”‚ python-docx  â”‚ â€¢ Documents       â”‚
â”‚         â”‚             â”‚ Document     â”‚ â€¢ Proposals       â”‚
â”‚         â”‚             â”‚              â”‚ â€¢ Contracts       â”‚
â”‚         â”‚             â”‚              â”‚ â€¢ Reports         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Text    â”‚ .txt        â”‚ Direct read  â”‚ â€¢ Notes           â”‚
â”‚         â”‚             â”‚ UTF-8/Latin1 â”‚ â€¢ Logs            â”‚
â”‚         â”‚             â”‚              â”‚ â€¢ Plain text      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MD      â”‚ .md         â”‚ Direct read  â”‚ â€¢ Documentation   â”‚
â”‚         â”‚             â”‚ UTF-8        â”‚ â€¢ READMEs         â”‚
â”‚         â”‚             â”‚              â”‚ â€¢ Wiki pages      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

All formats supported WITHOUT hardcoding!
```

---

## User Isolation Architecture

```
data/user_vectorstores/
â”‚
â”œâ”€â”€ user-alice-123/
â”‚   â”œâ”€â”€ chroma.sqlite3
â”‚   â”‚   (Alice's vector database)
â”‚   â”‚
â”‚   â””â”€â”€ collection-xyz/
â”‚       â”œâ”€â”€ document1.pdf chunks
â”‚       â”œâ”€â”€ document2.docx chunks
â”‚       â””â”€â”€ document3.txt chunks
â”‚
â”œâ”€â”€ user-bob-456/
â”‚   â”œâ”€â”€ chroma.sqlite3
â”‚   â”‚   (Bob's vector database)
â”‚   â”‚
â”‚   â””â”€â”€ collection-abc/
â”‚       â”œâ”€â”€ contract.pdf chunks
â”‚       â””â”€â”€ report.docx chunks
â”‚
â””â”€â”€ user-carol-789/
    â”œâ”€â”€ chroma.sqlite3
    â”‚   (Carol's vector database)
    â”‚
    â””â”€â”€ collection-def/
        â””â”€â”€ research.pdf chunks

Each user's data is COMPLETELY ISOLATED!
â€¢ No cross-user contamination
â€¢ Privacy-preserving
â€¢ Individual knowledge bases
```

---

## Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation            â”‚ Time      â”‚ Notes           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Upload 1MB PDF       â”‚ ~2-3s     â”‚ + embedding     â”‚
â”‚ Upload 10MB PDF      â”‚ ~10-15s   â”‚ + embedding     â”‚
â”‚ Create 100 chunks    â”‚ ~5-8s     â”‚ embedding time  â”‚
â”‚ Query (simple)       â”‚ ~1-2s     â”‚ local search    â”‚
â”‚ Query (complex)      â”‚ ~3-5s     â”‚ expansion + LLM â”‚
â”‚ Gemini API call      â”‚ ~2-4s     â”‚ network latency â”‚
â”‚ List documents       â”‚ <100ms    â”‚ metadata only   â”‚
â”‚ Delete document      â”‚ ~500ms    â”‚ DB operation    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Bottlenecks:
1. Embedding generation (CPU/GPU bound)
2. LLM API calls (network bound)
3. Large PDF text extraction (I/O bound)
```

---

*This visualization shows the complete, generic RAG system flow with NO hardcoding!*
